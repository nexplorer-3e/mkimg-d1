From 871134695da0bc71e42aae5fe6b8456046bf07ce Mon Sep 17 00:00:00 2001
From: eval <60149113+nexplorer-3e@users.noreply.github.com>
Date: Tue, 21 Nov 2023 15:40:40 +0800
Subject: fix build for thead toolchain

---
 arch/riscv/Makefile        | 4 ++--
 arch/riscv/kernel/vector.S | 2 +-
 2 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/arch/riscv/Makefile b/arch/riscv/Makefile
index 972fe3492..7e3e2c514 100644
--- a/arch/riscv/Makefile
+++ b/arch/riscv/Makefile
@@ -43,8 +43,8 @@ riscv-march-aflags-$(CONFIG_ARCH_RV32I)		:= rv32ima
 riscv-march-aflags-$(CONFIG_ARCH_RV64I)		:= rv64ima
 riscv-march-aflags-$(CONFIG_FPU)		:= $(riscv-march-aflags-y)fd
 riscv-march-aflags-$(CONFIG_RISCV_ISA_C)	:= $(riscv-march-aflags-y)c
-riscv-march-aflags-$(CONFIG_VECTOR)		:= $(riscv-march-aflags-y)v
-riscv-march-aflags-$(CONFIG_RISCV_ISA_THEAD)	:= $(riscv-march-aflags-y)xthead
+riscv-march-aflags-$(CONFIG_VECTOR)		:= $(riscv-march-aflags-y)v0p7
+riscv-march-aflags-$(CONFIG_RISCV_ISA_THEAD)	:= $(riscv-march-aflags-y)_xtheadc
 
 KBUILD_CFLAGS += -march=$(riscv-march-cflags-y) -Wa,-march=$(riscv-march-aflags-y)
 KBUILD_AFLAGS += -march=$(riscv-march-aflags-y)
diff --git a/arch/riscv/kernel/vector.S b/arch/riscv/kernel/vector.S
index 0afc308a6..c7f45e182 100644
--- a/arch/riscv/kernel/vector.S
+++ b/arch/riscv/kernel/vector.S
@@ -77,7 +77,7 @@ ENTRY(__vstate_restore)
 	csrw	CSR_VXRM, t0
 	ld	t0,  TASK_THREAD_VL_V0(a0)
 	ld	t2,  TASK_THREAD_VTYPE_V0(a0)
-	vsetvl	t0, t0, t2
+	vsetvl	t3, t0, t2
 
 	csrc	sstatus, t1
 	ret
-- 
2.42.0

